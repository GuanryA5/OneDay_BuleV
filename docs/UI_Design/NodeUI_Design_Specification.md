# BlueV节点UI设计规范（属性直显版）

**文档版本**: v1.0 (属性直显)
**创建日期**: 2025-08-31
**UI设计师**: PySide6 UI Designer
**项目**: BlueV游戏自动化蓝图框架

---

## 📋 设计概述

BlueV节点采用属性直显设计，废弃传统的属性浮窗概念，让用户可以直接在节点上查看和编辑所有重要参数，提供最直观的编辑体验。

### 🎯 设计目标
- **属性可视化**：所有重要属性直接显示在节点上
- **内联编辑**：点击属性值直接编辑，无需弹窗
- **信息层次**：核心参数突出显示，次要参数可折叠
- **自适应布局**：节点大小根据内容自动调整

---

## 🎨 节点UI设计规范

### 基础节点结构
```
┌─────────────────────────────────────┐
│ 🔍 在屏幕上查找图片        [🔗] [×] │ ← 节点标题栏+跳转按钮
│    Find Image on Screen             │ ← 英文副标题
├─────────────────────────────────────┤
│ 目标图像: [IMG_001: 卖出按钮] [📷]   │ ← 核心参数行
│ 查找区域: [全屏           ] [▼]    │ ← 下拉选择
│ 相似度阈值: [0.8          ]        │ ← 直接编辑
│ 间隔时间: [1000           ]ms      │ ← 直接编辑
│ 查询次数: [5              ]次      │ ← 直接编辑
├─────────────────────────────────────┤
│ ● 是否找到: Bool                    │ ← 多输出连接点
│ ● 找到坐标: Vector2D                │
│ ● 相似度: Float                     │
└─────────────────────────────────────┘
```

### 节点尺寸规范
- **最小宽度**: 200px
- **最大宽度**: 400px
- **自适应高度**: 根据参数数量动态调整
- **参数行高**: 28px
- **边距**: 8px内边距，4px外边距

---

## 🔧 不同类型节点设计

### 1. 在屏幕上查找图片节点（重新设计版）
```
┌─────────────────────────────────────┐
│ 🔍 在屏幕上查找图片        [🔗] [×] │
│    Find Image on Screen             │
├─────────────────────────────────────┤
│ 目标图像: [IMG_001: 卖出按钮] [📷]   │
│ 查找区域: [全屏           ] [▼]    │
│ 相似度阈值: [0.8          ]        │
│ 间隔时间: [1000           ]ms      │
│ 查询次数: [5              ]次      │
├─────────────────────────────────────┤
│ ● 是否找到: Bool → [条件分支]       │
│ ● 找到坐标: Vector2D → [点击节点]   │
│ ● 相似度: Float → [调试节点]        │
└─────────────────────────────────────┘
```

#### 在屏幕上查找图片节点参数说明

**🔗 跳转按钮**:
- 位于节点右上角，点击跳转到图库管理页面
- 自动定位到当前选中的目标图像方案
- 便于快速编辑图像设置和高级配置

**目标图像**:
- 点击📷图标选择或新建图像
- 显示图像名称和简短描述
- 鼠标悬停显示图像缩略图预览

**查找区域**:
- 下拉选择：全屏、自定义区域、绑定窗口
- 全屏：在整个屏幕范围内搜索
- 自定义区域：指定矩形搜索区域
- 绑定窗口：限定在特定窗口内搜索

**相似度阈值**:
- 直接编辑数值，范围0.0-1.0
- 默认值0.8，适合大多数场景
- 数值越高匹配越严格，越低匹配越宽松

**间隔时间**:
- 直接编辑数值，单位毫秒(ms)
- 每次查找尝试之间的等待时间
- 范围：100ms - 10000ms，默认1000ms

**查询次数**:
- 直接编辑数值，单位次
- 查找失败时的重试次数
- 范围：1次 - 100次，默认5次

#### 输出参数说明

**是否找到 (Bool)**:
- 布尔值，true表示找到图像，false表示未找到
- 常用于连接条件分支节点进行流程控制

**找到坐标 (Vector2D)**:
- 二维坐标值，表示找到图像的中心点位置
- 格式：(x, y)，如(1024, 768)
- 常用于连接点击节点进行精确点击

**相似度 (Float)**:
- 浮点数值，表示实际匹配的相似度
- 范围：0.0-1.0，数值越高表示匹配度越高
- 常用于调试和质量监控
---

### 2. 等待图片出现/消失节点（新增）
```
┌─────────────────────────────────────┐
│ ⏳ 等待图片出现/消失       [🔗] [×] │
│    Wait For Image                   │
├─────────────────────────────────────┤
│ ● 输入: 执行结果 ← [上一节点]       │
│ 目标图像: [IMG_002: 技能冷却] [📷]   │
│ 等待模式: [等待出现     ] [▼]      │
│ 查找区域: [全屏         ] [▼]      │
│ 相似度阈值: [0.8        ]          │
│ 超时时间: [30000        ]ms        │
├─────────────────────────────────────┤
│ ● 是否成功: Bool → [条件分支]       │
│ ● 找到坐标: Vector2D → [点击节点]   │
│ ● 等待时长: Float → [调试节点]      │
└─────────────────────────────────────┘
```

#### 等待图片出现/消失节点参数说明

**🔗 跳转按钮**:
- 位于节点右上角，点击跳转到图库管理页面
- 自动定位到当前选中的目标图像方案
- 便于快速编辑图像设置和高级配置

**目标图像**:
- 点击📷图标选择或新建图像
- 显示图像名称和简短描述
- 鼠标悬停显示图像缩略图预览

**等待模式**:
- 下拉选择：等待出现、等待消失
- 等待出现：暂停脚本直到图像出现在屏幕上
- 等待消失：暂停脚本直到图像从屏幕上消失

**查找区域**:
- 下拉选择：全屏、自定义区域、绑定窗口
- 全屏：在整个屏幕范围内监控
- 自定义区域：指定矩形监控区域
- 绑定窗口：限定在特定窗口内监控

**相似度阈值**:
- 直接编辑数值，范围0.0-1.0
- 默认值0.8，适合大多数场景
- 数值越高匹配越严格，越低匹配越宽松

**超时时间**:
- 直接编辑数值，单位毫秒(ms)
- 等待的最大时间，超时后停止等待
- 范围：1000ms - 300000ms，默认30000ms(30秒)

#### 等待节点输出参数说明

**是否成功 (Bool)**:
- 布尔值，true表示在超时前成功等到目标状态
- false表示超时未等到目标状态
- 常用于连接条件分支节点进行异常处理

**找到坐标 (Vector2D)**:
- 二维坐标值，表示图像的中心点位置
- 仅在"等待出现"模式且成功时有效
- 格式：(x, y)，如(1024, 768)

**等待时长 (Float)**:
- 浮点数值，表示实际等待的时间(秒)
- 用于性能分析和调试
- 范围：0.0 - 超时时间设置值

#### 等待节点典型使用场景

**等待技能冷却**:
```
等待模式: [等待消失]
目标图像: [技能冷却图标]
超时时间: [60000]ms
→ 等待技能冷却完成，冷却图标消失
```

**等待加载界面**:
```
等待模式: [等待消失]
目标图像: [加载进度条]
超时时间: [30000]ms
→ 等待加载完成，进度条消失
```

**等待施法条读完**:
```
等待模式: [等待消失]
目标图像: [施法进度条]
超时时间: [10000]ms
→ 等待施法完成，进度条消失
```

**等待界面元素出现**:
```
等待模式: [等待出现]
目标图像: [确认按钮]
超时时间: [15000]ms
→ 等待确认按钮出现，然后点击
```
---




----

### 2. 点击节点（简化版）
```
┌─────────────────────────────────────┐
│ 👆 点击节点                    [×]  │
├─────────────────────────────────────┤
│ ● 输入: 坐标(x,y) ← [找图节点]      │
│ 点击方式: [左键单击   ] [▼]        │
│ 点击次数: [1          ]次          │
│ 点击间隔: [100        ]ms          │
├─────────────────────────────────────┤
│ ● 输出: 执行结果 → [延迟节点]       │
└─────────────────────────────────────┘
```

### 3. 延迟节点（极简版）
```
┌─────────────────────────────────────┐
│ ⏱️ 延迟节点                    [×]  │
├─────────────────────────────────────┤
│ ● 输入: 执行结果 ← [点击节点]       │
│ 延迟时间: [2000       ]ms          │
├─────────────────────────────────────┤
│ ● 输出: 执行结果 → [下一节点]       │
└─────────────────────────────────────┘
```

### 5. 循环节点（复杂版）
```
┌─────────────────────────────────────┐
│ 🔄 循环节点                    [×]  │
├─────────────────────────────────────┤
│ 循环类型: [计数循环   ] [▼]        │
│ 循环次数: [10         ]次          │
│ 循环间隔: [1000       ]ms          │
├─────────────────────────────────────┤
│ ⚙️ 循环条件 [展开 ▼]                │
│ ┌─────────────────────────────────┐ │
│ │ 退出条件: [找到目标图像] [▼]     │ │
│ │ 最大时间: [30         ]秒       │ │
│ │ 错误处理: [继续执行] [▼]         │ │
│ └─────────────────────────────────┘ │
├─────────────────────────────────────┤
│ ● 循环体开始 → [子节点1]            │
│ ● 循环体结束 ← [子节点N]            │
│ ● 输出: 循环结果 → [下一节点]       │
└─────────────────────────────────────┘
```

---

## 🎛️ 参数编辑控件设计

### 1. 文本输入框
```
参数名称: [参数值        ]
         ↑ 点击直接编辑
```
- **交互**: 单击进入编辑模式
- **验证**: 实时参数验证
- **反馈**: 错误值红色边框提示

### 1.1. 数值输入框（带单位）
```
间隔时间: [1000       ]ms
         ↑ 点击直接编辑  ↑ 单位显示

找寻次数: [5          ]次
         ↑ 点击直接编辑  ↑ 单位显示
```
- **交互**: 单击数值区域进入编辑模式
- **单位**: 固定显示在输入框右侧
- **验证**: 只允许输入有效数值
- **范围**: 自动限制合理数值范围

### 2. 数值编辑框
```
参数名称: [0.8            ]
         ↑ 点击直接编辑数值
```
- **交互**: 点击数值区域进入编辑模式
- **验证**: 实时验证数值范围和格式
- **精度**: 根据参数类型自动调整小数位数

### 3. 下拉选择
```
参数名称: [选项内容    ] [▼]
         ↑ 显示当前选项  ↑ 点击展开
```
- **交互**: 点击展开选项列表
- **搜索**: 支持输入搜索选项
- **分组**: 选项过多时自动分组

### 4. 复选框
```
参数名称: [☑] 启用功能
         ↑ 点击切换状态
```
- **交互**: 点击切换选中状态
- **状态**: 清晰的选中/未选中视觉反馈

### 5. 图像选择器（带跳转功能）
```
目标图像: [IMG_001: 卖出按钮] [📷] [🔗]
         ↑ 显示图像名称      ↑选择 ↑跳转
```
- **交互**: 点击📷图标打开图像选择器
- **预览**: 鼠标悬停显示图像缩略图
- **管理**: 支持新建、编辑、删除图像
- **跳转**: 点击🔗图标跳转到图库管理页面对应图像

### 6. 跳转按钮设计
```
节点标题栏右侧:
┌─────────────────────────────────────┐
│ 🔍 找图节点                [🔗] [×] │
                           ↑跳转 ↑关闭
```
- **位置**: 位于节点标题栏右侧，关闭按钮左边
- **图标**: 🔗链接图标，表示跳转功能
- **交互**: 点击跳转到图库管理页面
- **定位**: 自动定位到当前节点使用的目标图像
- **状态**:
  - 正常状态: 蓝色图标
  - 悬停状态: 高亮显示
  - 无图像时: 灰色禁用状态

---

## 🎨 视觉设计规范

### 色彩方案
- **节点背景**: 浅灰色 (#F8F9FA)
- **标题栏**: 深蓝色 (#2196F3)
- **参数区**: 白色 (#FFFFFF)
- **输入框**: 浅蓝色边框 (#E3F2FD)
- **连接点**: 橙色 (#FF9800)

### 字体规范
- **节点标题**: 14px 粗体
- **参数名称**: 12px 常规
- **参数值**: 12px 常规
- **提示文本**: 10px 浅色

### 交互状态
- **正常状态**: 默认样式
- **悬停状态**: 轻微阴影效果
- **编辑状态**: 蓝色边框高亮
- **错误状态**: 红色边框警告
- **禁用状态**: 灰色半透明

---

## 🔗 连接点设计

### 输入连接点
```
● 输入: 数据类型 ← [来源节点]
↑ 圆形连接点   ↑ 连接线指示
```

### 输出连接点
```
● 输出: 数据类型 → [目标节点]
↑ 圆形连接点   ↑ 连接线指示
```

### 多输出连接点设计
```
在屏幕上查找图片节点的多输出:
├─────────────────────────────────────┤
│ ● 是否找到: Bool → [条件分支节点]    │ ← 绿色连接点
│ ● 找到坐标: Vector2D → [点击节点]    │ ← 蓝色连接点
│ ● 相似度: Float → [调试节点]         │ ← 橙色连接点
└─────────────────────────────────────┘
```

### 连接点特性
- **可视化**: 不同数据类型使用不同颜色
  - Bool: 绿色 (表示逻辑判断)
  - Vector2D: 蓝色 (表示坐标位置)
  - Float: 橙色 (表示数值数据)
- **智能连接**: 兼容类型自动高亮
- **连接反馈**: 连接成功时显示动画效果
- **多连接**: 单个输出可连接多个目标节点

---

## ⌨️ 交互设计规范

### 节点操作
- **选中**: 单击节点边框
- **移动**: 拖拽节点标题栏
- **编辑**: 单击参数值进入编辑模式
- **删除**: 选中后按Delete键
- **复制**: Ctrl+C/V复制粘贴

### 参数编辑
- **进入编辑**: 单击参数值
- **确认编辑**: Enter键或点击其他区域
- **取消编辑**: Esc键
- **快速调节**: 鼠标滚轮调节数值

### 折叠展开
- **折叠**: 点击"高级设置 [收起 ▲]"
- **展开**: 点击"高级设置 [展开 ▼]"
- **记忆状态**: 自动记住折叠状态

---

## 📱 响应式设计

### 节点自适应
- **宽度自适应**: 根据参数名称长度调整
- **高度自适应**: 根据参数数量调整
- **最小尺寸**: 保证基本可读性
- **最大尺寸**: 避免节点过大影响布局

### 参数布局
- **单列布局**: 参数较少时使用
- **双列布局**: 参数较多时自动切换
- **智能换行**: 参数名称过长时自动换行

---

## 🚀 设计优势总结

### 用户体验优势
- **直观性**: 所有参数一目了然
- **效率性**: 无需弹窗，直接编辑
- **一致性**: 统一的编辑交互方式
- **反馈性**: 实时参数验证和提示

### 技术实现优势
- **组件化**: 参数控件高度复用
- **性能优化**: 避免频繁弹窗创建销毁
- **内存友好**: 减少浮窗对象占用
- **维护简单**: 统一的参数管理逻辑

---

## 🎯 特殊节点设计

### 条件分支节点
```
┌─────────────────────────────────────┐
│ 🔀 条件分支                    [×]  │
├─────────────────────────────────────┤
│ ● 输入: 判断条件 ← [找图节点]       │
│ 条件类型: [图像存在   ] [▼]        │
│ 判断逻辑: [如果为真   ] [▼]        │
├─────────────────────────────────────┤
│ ● True输出 → [执行节点A]            │
│ ● False输出 → [执行节点B]           │
└─────────────────────────────────────┘
```

### 变量节点
```
┌─────────────────────────────────────┐
│ 📦 变量节点                         │
├─────────────────────────────────────┤
│ 变量名称: [counter    ] [✏️]       │
│ 变量类型: [整数       ] [▼]        │
│ 初始值:   [0          ] [━●━━━]     │
│ 作用域:   [全局       ] [▼]        │
├─────────────────────────────────────┤
│ ● 输出: 变量值 → [其他节点]         │
└─────────────────────────────────────┘
```

### 注释节点
```
┌─────────────────────────────────────┐
│ 💬 注释节点                    [×]  │
├─────────────────────────────────────┤
│ ┌─────────────────────────────────┐ │
│ │ 这里是注释内容...               │ │
│ │ 可以多行显示                    │ │
│ │ 支持富文本格式                  │ │
│ └─────────────────────────────────┘ │
├─────────────────────────────────────┤
│ 字体大小: [12px] [━●━━━]            │
│ 背景颜色: [黄色] [🎨]              │
└─────────────────────────────────────┘
```

---

## 🎨 节点状态设计

### 执行状态指示
```
正常状态:
┌─────────────────────────────────────┐
│ 🔍 找图节点                         │ ← 默认蓝色标题栏

执行中状态:
┌─────────────────────────────────────┐
│ 🔍 找图节点                    [⚡] │ ← 黄色标题栏+闪烁图标

执行成功:
┌─────────────────────────────────────┐
│ 🔍 找图节点                    [✅] │ ← 绿色标题栏+成功图标

执行失败:
┌─────────────────────────────────────┐
│ 🔍 找图节点                    [❌] │ ← 红色标题栏+错误图标

禁用状态:
┌─────────────────────────────────────┐
│ 🔍 找图节点                    [⏸️] │ ← 灰色标题栏+暂停图标
```

### 调试信息显示
```
调试模式下的节点:
┌─────────────────────────────────────┐
│ 🔍 找图节点                    [🐛] │
├─────────────────────────────────────┤
│ 目标图像: [IMG_001: 卖出按钮] [📷]   │
│ 匹配阈值: [0.8        ] [━━●━━]     │
├─────────────────────────────────────┤
│ 📊 调试信息 [展开 ▼]                │
│ ┌─────────────────────────────────┐ │
│ │ 执行时间: 245ms                 │ │
│ │ 匹配度: 0.85                    │ │
│ │ 找到坐标: (1024, 768)           │ │
│ │ 内存占用: 2.3MB                 │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

---

## 🔧 参数验证设计

### 实时验证反馈
```
正确参数:
相似度阈值: [0.8            ]
           ↑ 正常蓝色边框

间隔时间: [1000           ]ms
         ↑ 正常蓝色边框

查询次数: [5             ]次
         ↑ 正常蓝色边框

错误参数:
相似度阈值: [1.5            ]
           ↑ 红色边框 + 错误提示
           "相似度阈值范围应在0.0-1.0之间"

间隔时间: [50             ]ms
         ↑ 红色边框 + 错误提示
         "间隔时间不能小于100ms"

查询次数: [0              ]次
         ↑ 红色边框 + 错误提示
         "查询次数至少为1次"

警告参数:
相似度阈值: [0.95           ]
           ↑ 橙色边框 + 警告提示
           "阈值过高可能导致匹配失败"

查询次数: [50             ]次
         ↑ 橙色边框 + 警告提示
         "次数过多可能影响执行效率"

等待节点参数验证:
超时时间: [30000          ]ms
         ↑ 正常蓝色边框

超时时间: [500            ]ms
         ↑ 红色边框 + 错误提示
         "超时时间不能小于1000ms"

超时时间: [600000         ]ms
         ↑ 橙色边框 + 警告提示
         "超时时间过长可能影响用户体验"
```

### 参数依赖关系
```
条件参数显示:
循环类型: [条件循环   ] [▼]
↓ 当选择"条件循环"时显示
退出条件: [找到目标   ] [▼]
最大次数: [100次      ] [━━●━━]

↓ 当选择"计数循环"时显示
循环次数: [10次       ] [━━●━━]
```

---

## 📐 布局算法设计

### 自动布局规则
1. **参数优先级排序**
   - 核心参数: 始终显示
   - 常用参数: 默认显示
   - 高级参数: 折叠显示

2. **节点宽度计算**
   ```
   节点宽度 = max(
       最长参数名称宽度 + 控件宽度 + 边距,
       最小节点宽度(200px),
       min(最大节点宽度(400px))
   )
   ```

3. **节点高度计算**
   ```
   节点高度 = 标题栏高度(32px) +
             可见参数数量 × 参数行高(28px) +
             连接点区域高度(24px) +
             边距(16px)
   ```

### 响应式布局
- **小屏幕**: 单列参数布局
- **中屏幕**: 智能双列布局
- **大屏幕**: 可选三列布局（复杂节点）

---

**文档状态**: ✅ 节点UI设计规范已确认
**设计版本**: v1.4 (新增等待图片出现/消失节点)
**关键特性**: 属性直显、内联编辑、自适应布局、状态指示、多输出连接
**特殊功能**: 实时验证、调试信息、参数依赖、自动布局、图库跳转
**找图节点重新设计**:
- 节点名称: "在屏幕上查找图片 (Find Image on Screen)"
- 参数: 查找区域、相似度阈值、间隔时间、查询次数
- 输出: 是否找到(Bool)、找到坐标(Vector2D)、相似度(Float)
**新增等待节点**:
- 节点名称: "等待图片出现/消失 (Wait For Image)"
- 参数: 目标图像、等待模式、查找区域、相似度阈值、超时时间
- 输出: 是否成功(Bool)、找到坐标(Vector2D)、等待时长(Float)
- 使用场景: 技能冷却、加载界面、施法条、界面元素等待
**全局优化**: 所有节点统一使用直接编辑，废弃滑块调节
**下一步**: 开始PySide6节点组件实现
